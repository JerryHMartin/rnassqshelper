% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/yield_nass.R
\name{get_nass_yield}
\alias{get_nass_yield}
\title{Get NASS QuickStats yield data}
\usage{
get_nass_yield(
  state,
  year,
  commodity = "COTTON",
  statistic = "YIELD",
  agg_level = "COUNTY",
  freq = "MONTHLY",
  source_desc = "SURVEY",
  sector_desc = "CROPS",
  group_desc = "FIELD CROPS",
  key = NULL,
  add_missing_cols = TRUE,
  sleep = 0.25,
  as_tibble = TRUE,
  progress = TRUE,
  verbose = FALSE,
  use_progressr = FALSE,
  rnassqs_progress_bar = FALSE,
  ...
)
}
\arguments{
\item{state}{Character vector of full state names as recognized by NASS
(e.g., \code{"TEXAS"}, \code{"GEORGIA"}, \code{"SOUTH CAROLINA"}). Whitespace is trimmed.}

\item{year}{Integer or numeric vector of years (coerced to integer).}

\item{commodity}{Commodity description string. Default \code{"COTTON"}.
Passed to \code{commodity_desc}.}

\item{statistic}{Statistic category. Default \code{"YIELD"}.
Passed to \code{statisticcat_desc}.}

\item{agg_level}{Aggregation level description. Default \code{"COUNTY"}.
Passed to \code{agg_level_desc}.}

\item{freq}{Frequency description. Default \code{"MONTHLY"}.
Passed to \code{freq_desc}.}

\item{source_desc}{Source description. Default \code{"SURVEY"}.}

\item{sector_desc}{Sector description. Default \code{"CROPS"}.}

\item{group_desc}{Group description. Default \code{"FIELD CROPS"}.}

\item{key}{Optional NASS API key. If supplied and non-empty, the function
will call \code{rnassqs::nassqs_auth(key = key)} before querying.}

\item{add_missing_cols}{Logical; if \code{TRUE}, ensures \code{state_name} and \code{year}
columns exist in the returned data even if the API omitted them. Default \code{TRUE}.}

\item{sleep}{Numeric; seconds to pause between requests to be gentle with
the API. Set to \code{0} to disable. Default \code{0.25}.}

\item{as_tibble}{Logical; if \code{TRUE} (default), return a tibble; if \code{FALSE},
return a base \code{data.frame}.}

\item{progress}{Logical; if \code{TRUE}, display one cumulative progress bar
for all queries. Default \code{TRUE}.}

\item{verbose}{Logical; if \code{TRUE}, print the current state-year being queried
and a simple ETA. Default \code{FALSE}.}

\item{use_progressr}{Logical; if \code{TRUE}, use the {progressr} framework
for progress (requires the package). Default \code{FALSE}.}

\item{rnassqs_progress_bar}{Logical; passed to \code{rnassqs::nassqs(progress_bar = ...)}.
Default \code{FALSE} to suppress rnassqs’ internal bar so only the cumulative bar shows.}

\item{...}{Additional named parameters forwarded to \code{rnassqs::nassqs()}
(e.g., \code{county_name = "DORCHESTER"}, \code{state_alpha = "SC"},
\code{data_item = "COTTON, UPLAND - YIELD, MEASURED IN LB / ACRE"}).}
}
\value{
A tibble (default) or base \code{data.frame} with zero or more rows, depending on
\code{as_tibble}. If a given query returns no records or an error occurs, an empty
object is returned for that query; all results are row-bound into a single
result.
}
\description{
Retrieve yield statistics from USDA NASS QuickStats for one or more
state–year combinations. This wrapper keeps core crop/soil/water
workflows simple and consistent while relying on \code{rnassqs} under the hood.
}
\details{
\itemize{
\item Defaults align with typical yield workflows:
\code{statistic = "YIELD"}, \code{agg_level = "COUNTY"}, \code{freq = "MONTHLY"}.
You can override any of these for other aggregations or frequencies.
\item Accepts vectors for \code{state} and \code{year}; returns a single object combining
all results for the cartesian product of inputs.
\item Use \code{...} to pass additional QuickStats parameters such as
\code{county_name}, \code{state_alpha}, \code{domain_desc}, \code{data_item}, etc.
\item Authentication: either call \code{rnassqs::nassqs_auth(key = "<your key>")}
once at session start, or provide \code{key} to this function.
\item Progress:
\itemize{
\item By default, shows one cumulative progress bar (\code{progress = TRUE}).
\item \code{verbose = TRUE} prints the current state-year and a simple ETA.
\item \code{use_progressr = TRUE} uses the {progressr} ecosystem for richer,
customizable progress UIs (falls back to base progress bar if unavailable).
}
\item \code{rnassqs_progress_bar = FALSE} disables rnassqs’ \emph{internal} per-call bar,
preventing repeated \verb{100\%} lines during bulk downloads. (See rnassqs docs.)
}
}
\section{Authentication}{

The function will call \code{rnassqs::nassqs_auth(key = key)} if a non-empty
\code{key} is provided; otherwise, ensure you have authenticated earlier
in your session via \code{rnassqs::nassqs_auth()} and/or an environment variable.
}

\examples{
\donttest{
# Authenticate once (preferred)
rnassqs::nassqs_auth(Sys.getenv("NASS_API_KEY"))

# Single state-year, default yield/monthly/county for cotton (tibble return)
tx_2010 <- get_nass_yield(state = "TEXAS", year = 2010)

# Multi-state, multi-year (cartesian product), return data.frame
dat_df <- get_nass_yield(
  state = c("TEXAS", "GEORGIA"),
  year  = 2015:2016,
  as_tibble = FALSE,
  progress  = TRUE,
  verbose   = TRUE
)

# With {progressr} (if installed) for richer progress output:
# progressr::handlers(global = TRUE)  # choose a handler (e.g., cli, rstudio)
# dat <- get_nass_yield(
#   state = c("SOUTH CAROLINA", "GEORGIA"),
#   year  = 2018:2019,
#   use_progressr = TRUE
# )

# Supply a key directly (alternative to calling nassqs_auth)
dat2 <- get_nass_yield(
  state = "TEXAS", year = 2018,
  key = Sys.getenv("NASS_API_KEY")
)
}

}
\seealso{
\code{\link[rnassqs:nassqs]{rnassqs::nassqs()}} for the underlying API call and its \code{progress_bar}
parameter; \code{\link[progressr:progressor]{progressr::progressor()}} for customizable progress reporting.
}
